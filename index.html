<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>คำนวณและกระจายขนาดยา Warfarin</title>
  <style>
    body {
      font-family: "Kanit", sans-serif;
      background: #fff8f0;
      padding: 20px;
    }
    h1 {
      color: #b22222;
      text-align: center;
    }
    label {
      font-weight: bold;
    }
    input, button {
      padding: 6px;
      margin: 5px 0;
      font-size: 1em;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #999;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #ffe4e1;
    }
    .result {
      margin-top: 15px;
      padding: 10px;
      background: #faf0e6;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>

  <h1>เครื่องคำนวณและกระจายขนาดยา Warfarin</h1>

  <label for="weeklyDose">ขนาดยาต่อสัปดาห์ (mg):</label>
  <input type="number" id="weeklyDose" step="0.5" />

  <br/>
  <button onclick="calculateBalanced()">คำนวณ</button>

  <div class="result" id="result"></div>

  <script>
    const dayNames = ['จันทร์', 'อังคาร', 'พุธ', 'พฤหัส', 'ศุกร์', 'เสาร์', 'อาทิตย์'];

    function calculateBalanced() {
      let weeklyDose = parseFloat(document.getElementById('weeklyDose').value);
      if (isNaN(weeklyDose) || weeklyDose <= 0) {
        alert('กรุณากรอกขนาดยาต่อสัปดาห์ให้ถูกต้อง');
        return;
      }

      let dailyTarget = weeklyDose / 7;
      let days = [];

      // เริ่มกระจายโดยใกล้เคียง dailyTarget มากที่สุด
      for (let i = 0; i < 7; i++) {
        let bestCombo = null;
        let minDiff = Infinity;

        // ลองทุกการผสมเม็ด 2 และ 3 mg
        for (let n3 = 0; n3 <= 3; n3++) { 
          for (let n2 = 0; n2 <= 3; n2++) { 
            let total = n3 * 3 + n2 * 2;
            let diff = Math.abs(total - dailyTarget);
            if (total > 0 && diff < minDiff) {
              minDiff = diff;
              bestCombo = { n3, n2, total };
            }
          }
        }
        days.push(bestCombo);
      }

      // ปรับให้รวมใกล้ weeklyDose
      let totalMg = days.reduce((sum, d) => sum + d.total, 0);
      while (totalMg !== weeklyDose) {
        if (totalMg < weeklyDose) {
          // เพิ่มวันใดวันหนึ่ง +2 หรือ +3 mg
          let day = days.find(d => d.n3 + d.n2 < 3);
          if (day) {
            if (weeklyDose - totalMg >= 3) { day.n3++; totalMg += 3; }
            else { day.n2++; totalMg += 2; }
          } else break;
        } else {
          // ลดวันใดวันหนึ่ง -2 หรือ -3 mg
          let day = days.find(d => d.total > dailyTarget);
          if (day) {
            if (totalMg - weeklyDose >= 3 && day.n3 > 0) { day.n3--; totalMg -= 3; }
            else if (day.n2 > 0) { day.n2--; totalMg -= 2; }
            else break;
          } else break;
        }
      }

      // แสดงผล
      let html = `<p>ขนาดยารวมต่อสัปดาห์: <b>${weeklyDose} mg</b> (เฉลี่ยวันละ ${dailyTarget.toFixed(2)} mg)</p>`;
      html += `<table><tr><th>วัน</th><th>เม็ด 3 mg</th><th>เม็ด 2 mg</th><th>รวม (mg)</th></tr>`;
      days.forEach((d, i) => {
        html += `<tr>
          <td>${dayNames[i]}</td>
          <td>${d.n3}</td>
          <td>${d.n2}</td>
          <td>${d.total}</td>
        </tr>`;
      });
      html += `</table><p>รวมจริง: <b>${totalMg} mg</b></p>`;
      document.getElementById('result').innerHTML = html;
    }
  </script>

</body>
</html>
